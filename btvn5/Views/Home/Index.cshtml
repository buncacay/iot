<h2>Điều khiển đèn LED</h2>
<p id="statusText">Đang tải trạng thái...</p>
<button id="btnToggle">Đang tải...</button>

<script>
    const btnToggle = document.getElementById("btnToggle");
    const statusText = document.getElementById("statusText");
    let debounceTimeout;

    async function fetchState() {
        const res = await fetch("/control");
        const data = await res.json();
        updateUI(data.state);
    }

    function updateUI(state) {
        statusText.innerText = `Trạng thái LED: ${state.toUpperCase()}`;
        btnToggle.innerText = state === "on" ? "Tắt đèn" : "Bật đèn";
        btnToggle.dataset.state = state;
    }

    // ✅ Debounce để tránh gửi liên tục
    btnToggle.addEventListener("click", () => {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(async () => {
            const newState = btnToggle.dataset.state === "on" ? "off" : "on";
            const res = await fetch("/control", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ state: newState })
            });
            const data = await res.json();
            updateUI(data.state);
        }, 300);
    });

    fetchState();
    setInterval(fetchState, 3000); // tự refresh trạng thái mỗi 3s
</script>
